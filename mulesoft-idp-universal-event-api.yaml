asyncapi: 2.6.0
id: urn:mulesoft:com:idp:events
info:
  title: MuleSoft IDP Universal üåê Event API
  version: 1.0.0
  description: |-

    ## [ asyncapi Anypoint-specific MQ Bindings](https://github.com/asyncapi/bindings/blob/1a62858ef52dd968f4d5018245ea9b4ff411666f/anypointmq/README.md?plain=1#L5).

  license:
    name: Apache 2.0
    url: https://www.apache.org/licenses/LICENSE-2.0
  termsOfService: https://asyncapi.org/terms/
  contact:
    name: George Jeffcock
    url: https://blogs.mulesoft.com/dev-guides/event-driven-architecture-and-api-led-connectivity/
    email: gjeffcock@salesforce.com

externalDocs:
  description: specification/v2.6.0
  url: https://v2.asyncapi.com/docs/reference/specification/v2.6.0




defaultContentType: application/json

servers:
  anypoint-prd:
    url: anypointmq.server.anypoint-prd.url
    description: Anypoint MQ broker PRD Env
    protocol: anypointmq
    protocolVersion: v1
    tags:
      - name: env:production
        description: Anypoint MQ broker for production, in the US East (N. Virginia) runtime plane under management of the US control plane.


#    security:                  # Ignored for MQ
#      - oauthProd: []          # Ignored for MQ
#    bindings:                  # Ignored for MQ & will raise an Error in Designer
#      anypointmq:              # Ignored for MQ
#        bindingVersion: 0.1.0  # Ignored for MQ

  anypoint-dev:
    url: anypointmq.server.anypoint-dev.url
    description: Anypoint MQ broker DEV Env
    protocol: anypointmq
    protocolVersion: v1
    tags:
      - name: env:development
        description: Anypoint MQ broker for development, in the US East (N. Virginia) runtime plane under management of the US control plane.


channels:

  mulesoft.idp.callback.v1:
    description: MuleSoft IDP platform executed a callback on the change of status of a processing doc so channel used to process returned notifcations (callbacks) from IDP
    servers:
      - anypoint-dev
      - anypoint-prd
    subscribe:
      operationId: mulesoft.idp.callback.send.v1
      description: Produce (Send in asyncapi 3.0 Terminology) to Channel all IDP Callback Occurences
      summary: Send IDP Callback Event
      message:
        $ref: '#/components/messages/callback'
    publish:
      operationId: mulesoft.idp.callback.receive.v1
      description: Consume (Receive in asyncapi 3.0 Terminology) all IDP callbacks Occurences
      summary: Receive IDP Callback Event
      message:
        $ref: '#/components/messages/callback'
    bindings:
      anypointmq:
        destination: idp
        destinationType: exchange
        bindingVersion: latest
  
  mulesoft.idp.updated.status.{executionResult}.v1:
    description: |- 
      üè¢ Enterprise will be interested in knowing MuleSoft IDP platform has processed a doc request but the result stopped due to **FAILED** or **MANUAL_VALIDATION_REQUIRED**

      üö® BUT also more of a chance to show **parameters** in Async Apis ;) as this might actually be an anti-pattern  
      
      ## [Execution Results Reference](https://docs.mulesoft.com/idp/automate-document-processing-with-the-idp-api#execution-status-reference).

      - `ACKNOWLEDGED`: The document action execution request was received.
      - `IN_PROGRESS`: The execution started.
      - `RESULTS_PENDING`: The execution finished and IDP is processing the results.
      - `MANUAL_VALIDATION_REQUIRED`: The execution finished but the results need manual validation.
      - `FAILED`: The execution request finished unsuccessfully.
      - `PARTIAL_SUCCESS`: The execution request finished but some sub-tasks failed.
      - `SUCCEEDED`: The execution request finished successfully.

    parameters:
      executionResult:
        $ref: '#/components/parameters/executionResult'
    servers:
      - anypoint-dev
      - anypoint-prd
    subscribe:
      operationId: mulesoft.idp.updated.status.send.v1
      description: Send to Channel specfic IDP Status Changes
      summary: Send IDP Status Changes
      message:
        $ref: '#/components/messages/callback'
    publish:
      operationId: mulesoft.idp.updated.status.receive.v1
      description: Receive all IDP callbacks Occurences
      summary: Receive IDP Callback Event
      message:
        $ref: '#/components/messages/callback'
    bindings:
      anypointmq:
        destination: idp.status
        destinationType: fifo-queue
        bindingVersion: latest


components:

  parameters:
    executionResult:
      description: |- 
        ## [Execution Results Reference](https://docs.mulesoft.com/idp/automate-document-processing-with-the-idp-api#execution-status-reference).

        - `ACKNOWLEDGED`: The document action execution request was received.
        - `IN_PROGRESS`: The execution started.
        - `RESULTS_PENDING`: The execution finished and IDP is processing the results.
        - `MANUAL_VALIDATION_REQUIRED`: The execution finished but the results need manual validation.
        - `FAILED`: The execution request finished unsuccessfully.
        - `PARTIAL_SUCCESS`: The execution request finished but some sub-tasks failed.
        - `SUCCEEDED`: The execution request finished successfully.
      schema:
        type: string
        enum:
          - failed
          - manualvalidationrequired
          
  
  messages:
    callback:
      payload:
        type: object
        properties:
          orderId:
            type: string
          customerName:
            type: string
          email:
            type: string

#  securitySchemes:
#    oauthProd:
#      type: oauth2
#      flows:
#        clientCredentials:
#          tokenUrl: 'https://mq-us-east-1.anypoint.mulesoft.com/api/v1/authorize'
#          scopes: {}