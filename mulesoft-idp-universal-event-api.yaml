asyncapi: 2.6.0
id: urn:mulesoft:com:idp:events
info:
  title: MuleSoft IDP Universal üåê Event API
  version: 1.0.0
  description: |-

    https://v2.asyncapi.com/docs/reference/specification/v2.6.0

    https://github.com/asyncapi/bindings/blob/1a62858ef52dd968f4d5018245ea9b4ff411666f/anypointmq/README.md?plain=1#L5

    https://github.com/asyncapi/spec/blob/v2.6.0/spec/asyncapi.md

    https://github.com/asyncapi/bindings/blob/1a62858ef52dd968f4d5018245ea9b4ff411666f/anypointmq/README.md?plain=1#L5

  license:
    name: Apache 2.0
    url: https://www.apache.org/licenses/LICENSE-2.0
  termsOfService: https://asyncapi.org/terms/
  contact:
    name: George Jeffcock
    url: https://blogs.mulesoft.com/dev-guides/event-driven-architecture-and-api-led-connectivity/
    email: gjeffcock@salesforce.com

defaultContentType: application/json

servers:
  anypoint-prd:
    url: ${anypointmq.server.anypoint-prd.url}
    description: Anypoint MQ broker PRD Env
    protocol: anypointmq
    protocolVersion: v1
    tags:
      - name: env:production
        description: Anypoint MQ broker for production, in the US East (N. Virginia) runtime plane under management of the US control plane.

#    security:                  # Ignored for MQ
#      - oauthProd: []          # Ignored for MQ
#    bindings:                  # Ignored for MQ & will raise an Error in Designer
#      anypointmq:              # Ignored for MQ
#        bindingVersion: 0.1.0  # Ignored for MQ

  anypoint-dev:
    url: ${anypointmq.server.anypoint-dev.url}
    description: Anypoint MQ broker DEV Env
    protocol: anypointmq
    protocolVersion: v1
    tags:
      - name: env:development
        description: Anypoint MQ broker for development, in the US East (N. Virginia) runtime plane under management of the US control plane.


channels:

  mulesoft.idp.callback.v1:
    description: MuleSoft IDP platform executed a callback on the change of status of a processing doc
    servers:
      - anypoint-dev
      - anypoint-prd
    subscribe:
      operationId: mulesoft.idp.callback.v1.sub
      description: Produce (Send) to Channel all IDP Callback Occurences
      summary: Produce IDP Callback Event
      message:
        $ref: '#/components/messages/OrderPlaced'
    publish:
      operationId: mulesoft.idp.callback.v1.pub
      description: Consume all IDP callbacks Occurences
      summary: Consume IDP Callback Event
      message:
        $ref: '#/components/messages/OrderPlaced'
  
  mulesoft.idp.status.v1.{status}:
    parameters:
      status:
        $ref: '#/components/parameters/status'
    description: IDP callback Channel
    servers:
      - anypoint-dev
      - anypoint-prd
    subscribe:
      operationId: mulesoft.idp.status.v1.sub
      description: Produce (Send) to Channel all IDP Callback Occurences
      summary: Produce IDP Callback Event
      message:
        $ref: '#/components/messages/OrderPlaced'
    publish:
      operationId: mulesoft.idp.status.v1.pub
      description: Consume all IDP callbacks Occurences
      summary: Consume IDP Callback Event
      message:
        $ref: '#/components/messages/OrderPlaced'


components:

  parameters:
    status:
      description: The ID of the streetlight.
      schema:
        type: string
  
  messages:
    OrderPlaced:
      payload:
        type: object
        properties:
          orderId:
            type: string
          customerName:
            type: string
          email:
            type: string
          items:
            type: array
            items:
              type: object
              properties:
                productId:
                  type: string
                productName:
                  type: string
                quantity:
                  type: integer
                price:
                  type: number

#  securitySchemes:
#    oauthProd:
#      type: oauth2
#      flows:
#        clientCredentials:
#          tokenUrl: 'https://mq-us-east-1.anypoint.mulesoft.com/api/v1/authorize'
#          scopes: {}